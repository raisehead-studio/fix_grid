<ul class="sticky top-0 z-50 flex items-center border-b p-4 bg-white shadow">
  <!-- å·¦å´å¯æ©«å‘æ»¾å‹•çš„é ç±¤ -->
  <div class="flex gap-4 overflow-x-auto whitespace-nowrap flex-1 pr-4">
    {% for p, acts in pages.items() %}
      <li class="flex-shrink-0 list-none">
        <a href="{{ url_for('page_info', page=p) }}"
           class="text-blue-600 hover:underline {{ 'font-bold' if p == current_page else '' }}">
           {{ page_name_map.get(p, p) }}
        </a>
      </li>
    {% endfor %}
  </div>

  <!-- å³å´å›ºå®šå€å¡Š -->
  <li class="list-none text-gray-700 ml-4">ä½ å¥½ï¼Œ{{ current_user.full_name }}</li>
  <li class="list-none ml-4">
    <a href="#" onclick="confirmLogout()" class="text-red-600 hover:underline flex items-center gap-1">
      <span>ç™»å‡º</span>
    </a>
  </li>
</ul>

<!-- ğŸ”„ Loading Modal -->
<div id="loading-modal" class="fixed inset-0 bg-black bg-opacity-30 z-[999] hidden flex items-center justify-center">
  <div class="bg-white p-6 rounded-xl shadow-lg flex items-center gap-4">
    <svg class="animate-spin h-6 w-6 text-blue-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
      <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
      <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"></path>
    </svg>
    <span class="text-gray-700">è¼‰å…¥ä¸­ï¼Œè«‹ç¨å€™...</span>
  </div>
</div>

<script>
  function showLoading() {
    document.getElementById('loading-modal').classList.remove('hidden');
  }

  function hideLoading() {
    document.getElementById('loading-modal').classList.add('hidden');
  }

  function confirmLogout() {
    if (confirm('ç¢ºå®šè¦ç™»å‡ºå—ï¼Ÿ')) {
      window.location.href = "{{ url_for('logout') }}";
    }
  }

  // å„²å­˜åŸå§‹ fetch
  const originalFetch = window.fetch;

  // æ›¿æ›æˆåŒ…è£éçš„ fetch
  window.fetch = async function(...args) {
    try {
      showLoading(); // é–‹å•Ÿ loading
      const response = await originalFetch(...args);
      return response;
    } catch (error) {
      throw error;
    } finally {
      hideLoading(); // ç„¡è«–æˆåŠŸæˆ–å¤±æ•—éƒ½é—œé–‰ loading
    }
  };
</script>
