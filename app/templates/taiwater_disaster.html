<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>å°æ°´å…¬å¸ç½å®³é€šå ±å½™æ•´</title>
  <script>
    const currentUser = {{ {
      "id": current_user.id,
      "username": current_user.username,
      "full_name": current_user.full_name,
      "role_id": current_user.role_id,
      "role_name": current_user.role_name,
      "district_id": current_user.district_id,
      "district": current_user.district,
      "village": current_user.village,
      "phone": current_user.phone
    } | tojson }};
    const userPermissions = {{ user_permissions | tojson }};
  </script>
  <script src="/static/js/tailwindcss.js"></script>
  <script src="/static/js/xlsx.latest.min.js"></script>
</head>
<body class="bg-gray-100">
  {% include 'navigation.html' %}
  <div class="p-4 flex justify-between">
    <h2 class="text-2xl font-bold">å°æ°´å…¬å¸ç½å®³é€šå ±å½™æ•´</h2>
  </div>

  {% block content %}
  <div class="p-4">
    <div class="flex justify-between items-center">
      <!-- å·¦å´ï¼šlabel + select + æ–°å¢æŒ‰éˆ• -->
      <div class="flex items-center space-x-2">
        <label for="history-select" class="whitespace-nowrap">æ­·å²è³‡æ–™ï¼š</label>
        <select id="history-select" class="border p-2 rounded">
          <option value="">è«‹é¸æ“‡...</option>
        </select>
        <button onclick="openNewModal()" class="bg-blue-500 text-white px-4 py-2 rounded">ï¼‹ æ–°å¢</button>
        <button id="delete-btn" onclick="openDeleteModal()" class="bg-red-500 text-white px-4 py-2 rounded hidden">ğŸ—‘ï¸ åˆªé™¤</button>
      </div>

      <!-- å³å´ï¼šä¸Šå‚³ Excel -->
      <div class="flex items-center space-x-2">
        <button onclick="downloadSelectedExcel()" class="ml-2 px-3 py-2 bg-yellow-600 text-white rounded">ä¸‹è¼‰æ­¤ç­†è³‡æ–™</button>
        <button onclick="openUploadModal()" class="ml-4 px-3 py-2 bg-green-600 text-white rounded whitespace-nowrap">ä¸Šå‚³ Excel</button>
        <button onclick="downloadExampleExcel()" class="ml-2 px-3 py-2 bg-gray-700 text-white rounded">ä¸‹è¼‰ç¯„ä¾‹æª”æ¡ˆ</a>
      </div>
    </div>

    <div class="mt-4 bg-white shadow rounded p-4">
      <table id="excel-table" class="w-full table-auto border text-sm">
        <thead>
          <tr>
            <th></th><th></th><th></th>
            <th colspan="3">åœæ°´</th><th colspan="3">é™å£“</th>
            <th></th><th></th>
          </tr>
          <tr class="border-b font-semibold text-left">
            <th>åºè™Ÿ</th><th>è¡Œæ”¿å€</th><th>é‡Œ</th>
            <th>ç›®å‰åœæ°´æˆ¶æ•¸</th><th>å·²å¾©æ°´æˆ¶æ•¸</th><th>ç´¯ç©åœæ°´æˆ¶æ•¸</th>
            <th>ç›®å‰é™å£“æˆ¶æ•¸</th><th>å·²é™å£“æˆ¶æ•¸</th><th>ç´¯ç©é™å£“æˆ¶æ•¸</th>
            <th>å½±éŸ¿æˆ¶æ•¸</th><th>é è¨ˆå¾©æ°´æ™‚é–“</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <!-- æ–°å¢ modal -->
    <div id="new-modal" class="fixed inset-0 hidden bg-black bg-opacity-50 flex items-center justify-center">
      <form class="bg-white p-6 rounded shadow space-y-4" onsubmit="submitNew(event)">
        <h3 class="font-bold text-lg">æ–°å¢æ­·å²è³‡æ–™</h3>
        <input name="name" placeholder="åç¨±" class="w-full border p-2" required>
        <div class="flex justify-end">
          <button type="button" onclick="closeNewModal()" class="px-4 py-2 border rounded mr-2">å–æ¶ˆ</button>
          <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded">å„²å­˜</button>
        </div>
      </form>
    </div>

    <!-- ä¸Šå‚³ modal -->
    <div id="upload-modal" class="fixed inset-0 hidden bg-black bg-opacity-50 flex items-center justify-center z-50">
      <form id="upload-form" class="bg-white p-6 rounded shadow space-y-4" onsubmit="submitExcelUpload(event)">
        <h3 class="text-lg font-bold">ä¸Šå‚³ Excel æª”æ¡ˆ</h3>
        <input type="file" name="file" accept=".xlsx" required class="w-full border p-2">
        <div class="flex justify-end">
          <button type="button" onclick="closeUploadModal()" class="px-4 py-2 border rounded mr-2">å–æ¶ˆ</button>
          <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded">ä¸Šå‚³</button>
        </div>
      </form>
    </div>

    <!-- è¦†è“‹æç¤º modal -->
    <div id="confirm-overwrite-modal" class="fixed inset-0 hidden bg-black bg-opacity-50 flex items-center justify-center z-50">
      <div class="bg-white p-6 rounded shadow space-y-4">
        <p>âš ï¸ æ­¤æ­·å²è³‡æ–™å·²æœ‰ä¸Šå‚³æª”æ¡ˆï¼Œæ˜¯å¦è¦è¦†è“‹ï¼Ÿ</p>
        <div class="flex justify-end">
          <button onclick="cancelOverwrite()" class="px-4 py-2 border rounded mr-2">å–æ¶ˆ</button>
          <button onclick="confirmOverwrite()" class="px-4 py-2 bg-red-600 text-white rounded">è¦†è“‹</button>
        </div>
      </div>
    </div>

    <!-- ç¢ºèªåˆªé™¤ modal -->
    <div id="delete-modal" class="fixed inset-0 hidden bg-black bg-opacity-50 flex items-center justify-center z-50">
      <div class="bg-white p-6 rounded shadow space-y-4">
        <h3 class="text-lg font-bold text-red-600">ç¢ºèªåˆªé™¤</h3>
        <p>âš ï¸ ç¢ºå®šè¦åˆªé™¤ã€Œ<span id="delete-item-name"></span>ã€é€™ç­†æ­·å²è³‡æ–™å—ï¼Ÿ</p>
        <p class="text-sm text-gray-600">æ­¤æ“ä½œç„¡æ³•å¾©åŸï¼Œç›¸é—œçš„ Excel æª”æ¡ˆä¹Ÿæœƒè¢«åˆªé™¤ã€‚</p>
        <div class="flex justify-end">
          <button onclick="closeDeleteModal()" class="px-4 py-2 border rounded mr-2">å–æ¶ˆ</button>
          <button onclick="confirmDelete()" class="px-4 py-2 bg-red-600 text-white rounded">ç¢ºèªåˆªé™¤</button>
        </div>
      </div>
    </div>
  </div>
  {% endblock %}
  <script src="../static/utils.js"></script>
  <script src="../static/taiwater_disaster.js"></script>
</body>
</html>
