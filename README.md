# Fix Grid - 高雄市公用事業停電停水通報系統

## 專案概述

**Fix Grid** 是一個基於 Flask 的網頁應用程式，專為高雄市緊急管理和公用事業停電停水通報而設計。這是一個綜合性的系統，用於管理停電、停水和災害通報，並具備基於角色的存取控制功能。

## 核心架構

### 技術堆疊
- **後端**: Flask (Python 網頁框架)
- **資料庫**: SQLite (`kao_power_water.db`)
- **前端**: HTML 模板與 JavaScript
- **認證**: Flask-Login 與基於角色的權限管理
- **部署**: Docker 與 Nginx 反向代理
- **資料處理**: 使用 openpyxl 的 Excel 匯出功能

### 應用程式結構
```
fix_grid/
├── app/                    # 主要 Flask 應用程式
│   ├── __init__.py        # 應用程式工廠和核心路由
│   ├── models.py          # 資料庫模型和查詢
│   ├── routes/            # Blueprint 模組
│   ├── templates/         # HTML 模板
│   └── static/           # JavaScript 和靜態檔案
├── db/                    # SQL 初始化腳本
├── districts/            # 高雄市地理資料
└── Docker 配置檔案
```

## 主要功能

### 1. 基於角色的存取控制系統
- **7 種使用者角色**: 超級管理員, 管理員, 民政局幹事, 里幹事, 台電人員, 台水人員, 上級長官
- **基於權限的存取** 不同頁面和功能
- **密碼安全性** 90天過期政策

### 2. 停電管理
- **通報建立**: 使用者可建立停電通報
- **狀態追蹤**: 追蹤修復狀態和台電支援
- **地理資料**: 通報連結到區和里
- **Excel 匯出**: 產生包含圖表的綜合報告

### 3. 停水管理
- **水廠通報**: 追蹤供水問題
- **台水整合**: 台灣自來水公司狀態更新
- **聯絡資訊**: 儲存受影響區域聯絡詳情

### 4. 災害管理
- **緊急通報**: 處理各種災害情況
- **多公用事業支援**: 協調停電和停水問題
- **即時更新**: 狀態追蹤和修復預估

### 5. 地理覆蓋範圍
- **38 個區**: 高雄市完整覆蓋
- **里級資料**: 詳細地理細分
- **區域篩選**: 根據使用者指派區域篩選通報

## 資料庫結構

### 核心表格
- **users**: 使用者帳戶與角色和地理指派
- **roles**: 使用者角色定義
- **permissions**: 頁面和功能權限
- **role_permissions**: 角色權限對應
- **districts**: 高雄市 38 個行政區
- **villages**: 區下行政單位

### 通報表格
- **power_reports**: 停電事件通報
- **water_reports**: 供水問題通報
- **taiwater_power_reports**: 跨公用事業協調
- **user_login_logs**: 認證追蹤

## API 端點

### 認證與使用者管理
- `/` - 登入頁面
- `/dashboard` - 主要儀表板
- `/profile` - 使用者個人資料管理
- `/api/accounts` - 使用者帳戶管理

### 通報管理
- `/api/power_reports` - 停電 CRUD 操作
- `/api/water_reports` - 停水 CRUD 操作
- `/api/taipower_reports` - 台電協調
- `/api/taiwater_reports` - 台水協調

### 資料匯出
- `/api/export-excel` - Excel 報告產生
- `/api/power_stats` - 停電統計
- `/api/water_stats` - 停水統計

## 安全功能

### 密碼政策
- **最少 12 字元**
- **複雜度要求**: 大寫、小寫、數字、特殊字元
- **90 天過期** 強制密碼變更
- **登入追蹤** IP 記錄

### 存取控制
- **路由保護** 使用 `@login_required`
- **權限驗證** 頁面存取前
- **基於角色的資料篩選** (例如: 里幹事只能看到其里內通報)

## 部署配置

### Docker 設定
- **多容器**: Flask 應用程式 + Nginx 代理
- **磁碟區掛載**: 用於開發和資料持久化
- **埠對應**: 80:80 用於網頁存取

### 環境配置
- **開發模式** 啟用除錯
- **環境變數** 用於埠配置
- **資料庫初始化** 容器啟動時

## 地理資料

系統包含高雄市完整地理資料:
- **38 個區** 個別里清單
- **階層結構**: 區 → 里
- **中文命名** 正確行政區劃

## 業務邏輯

### 通報工作流程
1. **通報建立**: 使用者建立停電/停水通報
2. **狀態更新**: 追蹤修復進度
3. **公用事業協調**: 與台電/台水整合
4. **解決追蹤**: 監控直到完全修復
5. **資料匯出**: 產生分析報告

### 使用者體驗
- **響應式介面** 現代化 UI
- **即時更新** 透過 JavaScript
- **Excel 整合** 資料匯出
- **行動友善** 設計

## 安裝與執行

### 本地開發
```bash
# 安裝依賴
pip install -r requirements.txt

# 初始化資料庫
python init_db.py

# 執行應用程式
python app.py
```

### Docker 部署
```bash
# 建立並啟動容器
docker-compose up -d

# 查看日誌
docker-compose logs -f
```

## 專案特色

這是一個**生產就緒的緊急管理系統**，專門為高雄市公用事業基礎設施設計，具備:
- 完整的基於角色存取控制
- 地理資料管理
- 多公用事業協調能力
- 即時狀態追蹤
- 綜合報告產生

## 技術細節

### 依賴套件
- Flask: 網頁框架
- Flask-Login: 使用者認證
- Flask-WTF: 表單處理
- openpyxl: Excel 檔案處理
- python-dotenv: 環境變數管理

### 資料庫
- SQLite 作為主要資料庫
- 自動初始化腳本
- 備份和恢復機制

### 前端
- 原生 JavaScript
- 響應式 HTML/CSS
- 即時資料更新
- 互動式圖表

---

**版本**: 1.0.0  
**維護者**: 高雄市政府  
**授權**: 內部使用 